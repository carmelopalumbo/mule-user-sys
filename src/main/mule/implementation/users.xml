<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:db="http://www.mulesoft.org/schema/mule/db"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="get-users" doc:id="3d665b20-595e-4d08-8bf7-de0d1ac4d829" >
		<logger level="INFO" doc:name="Start flow" doc:id="121ad746-ecf6-4283-8782-32bd5ca937f6" message='#["Start flow GET users with correlationId: " ++ (vars.correlationId default "N/A")]' />
		<ee:transform doc:name="dbQuery" doc:id="37817315-172e-42d8-8ac8-acd75b9c3645">
			<ee:message>
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="dbQuery" ><![CDATA[%dw 2.0
output application/json
---
"SELECT * FROM users_db.users"]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<until-successful maxRetries="${untilSuccessful.maxRetries}" doc:name="Until Successful" doc:id="626f26ac-bcd2-4bec-aee6-6bc413c14089" >
			<db:select doc:name="Select" doc:id="0c6b23b4-8b7b-4568-a301-113821ba7798" config-ref="Database_Config">
			<db:sql><![CDATA[#[vars.dbQuery]]]></db:sql>
		</db:select>
		</until-successful>
		<ee:transform doc:name="Payload to JSON" doc:id="8305668a-e259-4e1c-8d67-8325f8bdbeff">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="DEBUG" doc:name="Debug payload after SELECT" doc:id="6caaf2e2-9dfc-4c09-9f73-52b3b69a9ba3" message='#["DEBUG payload after SELECT: " ++ payload.^raw]'/>
		<logger level="INFO" doc:name="End flow" doc:id="46f59dcc-1a6e-4f12-b54a-67095ff75e96" message='#["Start flow GET users with correlationId: " ++ (vars.correlationId default "N/A")]' />
	</sub-flow>
	<sub-flow name="get-users-by-id" doc:id="04028ae2-300f-4840-8538-a88bc7cb6bde" >
		<logger level="INFO" doc:name="Logger" doc:id="f251ebbf-9df9-4569-be9b-a1cd67cd99f2" message="test" />
	</sub-flow>
	<sub-flow name="post-users" doc:id="16055850-be66-4e82-b858-b6e5b5ee15b7" >
		<logger level="INFO" doc:name="Logger" doc:id="0b9303ba-a664-4689-9f91-4430a9696d69" message="test" />
	</sub-flow>
	<sub-flow name="put-users" doc:id="a085e5e6-8f8d-4f09-bbcd-9410dbe16604" >
		<logger level="INFO" doc:name="Logger" doc:id="41184d2c-74f8-46cc-989a-23ae333c0320" message="test" />
	</sub-flow>
	<sub-flow name="patch-users" doc:id="f6e81dca-30a4-452f-bb85-6fabafb8641f" >
		<logger level="INFO" doc:name="Logger" doc:id="f669e289-6cf9-40cc-997d-5b8765cdfc5b" message="test" />
	</sub-flow>
	<sub-flow name="delete-users" doc:id="d2c4cb1b-6b78-4269-af46-ce398f3b0440" >
		<logger level="INFO" doc:name="Logger" doc:id="3e8d8c40-be66-47d4-b039-361548be78df" message="test" />
	</sub-flow>
</mule>
